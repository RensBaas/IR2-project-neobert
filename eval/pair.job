#!/bin/bash

#SBATCH --partition=gpu_a100
#SBATCH --gpus=1
#SBATCH --job-name=eval_pair
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=9
#SBATCH --time=8:00:00
#SBATCH --output=logs/pair_%j.out
#SBATCH --error=logs/pair_%j.err

module purge
module load 2024
module load Anaconda3/2024.06-1

source pairenv/bin/activate

cd IR2-project-neobert/eval

for random_state in {1..3}
do
    for dataset in "synthetic" "natural"
    do
        for model in "bert-dense" "neobert-dense"
        do
            for emb in "sentence-t5-xl"  # add others if needed
            do
                echo "Running: dataset=$dataset model=$model emb=$emb random_state=$random_state"

                # The original had an echo + a run with GPU 1.
                # SLURM controls GPU visibility, so we remove CUDA_VISIBLE_DEVICES.
                python -m pairsrc.experiments.run_audit \
                    --dataset "$dataset" \
                    --fit_dataset "synthetic" \
                    --model "$model" \
                    --embedding_model "$emb" \
                    --results_dir "results_$emb" \
                    --random_state "$random_state" \
                    --spurious_dataset "spurious"
            done
        done
    done
done
